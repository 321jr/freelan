import os

from teapot import *  # noqa
from teapot.filters.filter import named_filter

# General settings
set_option('cache_root', 'third-party/cache')
set_option('sources_root', 'third-party/sources')
set_option('builds_root', 'third-party/builds')
set_option('prefix', 'third-party/install')


@named_filter('x64')
def is_x64():
    return os.environ.get('ARCHITECTURE') == 'x64'


@named_filter('x86')
def is_x86():
    return os.environ.get('ARCHITECTURE') == 'x86'

# boost
Attendee('boost').add_source(
    'http://sourceforge.net/projects/boost/files/boost/1.58.0/boost_1_58_0.zip/download',
    filter='windows',
    mimetype='application/zip',
)

Attendee('boost').add_build(
    'msvc-x86',
    environment='system',
    filter='x86',
    prefix='x86',
)
Attendee('boost').get_build('msvc-x86').commands = [
    r'bootstrap.bat',
    r'b2 -j7 --prefix={{prefix}} --layout=versioned --without-serialization toolset=msvc-12.0 variant=release link=static threading=multi runtime-link=shared install',
    r'xcopy bjam.exe {{prefix}}\bin\ /S /Y',
    r'b2 -j7 --prefix={{prefix}} --layout=versioned --without-serialization toolset=msvc-12.0 variant=debug link=static threading=multi runtime-link=shared install',
]

Attendee('boost').add_build(
    'msvc-x64',
    environment='system',
    filter='x64',
    prefix='x64',
)
Attendee('boost').get_build('msvc-x64').commands = [
    r'bootstrap.bat',
    r'b2 -j7 --prefix={{prefix}} --layout=versioned --without-serialization toolset=msvc-12.0 variant=release link=static threading=multi runtime-link=shared address-model=64 install',
    r'xcopy bjam.exe {{prefix}}\bin\ /S /Y',
    r'b2 -j7 --prefix={{prefix}} --layout=versioned --without-serialization toolset=msvc-12.0 variant=debug link=static threading=multi runtime-link=shared address-model=64 install',
]
